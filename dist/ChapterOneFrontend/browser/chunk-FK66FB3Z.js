import{a as R}from"./chunk-YRGBYMMP.js";import"./chunk-HOACR73J.js";import{f as L,h as A,i as P}from"./chunk-X5XJS3OX.js";import{Aa as v,Ab as D,Ea as y,Oa as k,Pa as d,Qa as s,Qb as T,Rb as B,Sb as j,Ta as _,Tb as F,Ua as C,V as g,Va as E,W as h,Wa as t,Xa as i,Ya as m,eb as p,kb as f,lb as a,mb as l,nb as b,ob as O,pb as I,qa as S,sa as o,ub as M,yb as u,zb as x}from"./chunk-QMVCZU7Z.js";var z=(n,r)=>r.label;function G(n,r){n&1&&(t(0,"div",4),m(1,"div",6)(2,"div",7)(3,"div",8),i())}function U(n,r){if(n&1&&(t(0,"div",5),g(),t(1,"svg",9),m(2,"path",10),i(),h(),t(3,"h6",11),a(4,"Order not found"),i(),t(5,"p",12),a(6),i(),t(7,"a",13),a(8,"Back to Orders"),i()()),n&2){let e=p();o(6),l(e.error)}}function V(n,r){n&1&&(g(),t(0,"svg",42),m(1,"path",44),i())}function q(n,r){if(n&1&&(t(0,"span",43),a(1),i()),n&2){let e=p().$index;o(),l(e+1)}}function H(n,r){if(n&1&&(t(0,"div",19)(1,"div",41),d(2,V,2,0,":svg:svg",42)(3,q,2,1,"span",43),i(),t(4,"small"),a(5),i()()),n&2){let e=r.$implicit;o(),f(e.done?e.active?"bg-blue-600 text-white":"bg-green-600 text-white":"bg-gray-100 text-gray-400 border"),o(),s(e.done&&!e.active?2:3),o(2),f(e.done?"font-semibold text-sm":"text-sm text-gray-500"),o(),l(e.label)}}function N(n,r){n&1&&(t(0,"div",25),a(1,"No items"),i())}function Q(n,r){if(n&1&&m(0,"img",45),n&2){let e=p().$implicit;E("src",e.book==null?null:e.book.coverUrl,S)("alt",e.book==null?null:e.book.title)}}function J(n,r){n&1&&(t(0,"div",46),g(),t(1,"svg",50),m(2,"path",51),i()())}function K(n,r){if(n&1&&(t(0,"small",12),a(1),i()),n&2){let e=p(2).$implicit;o(),b("by ",e.book.author==null?null:e.book.author.name)}}function W(n,r){if(n&1&&(t(0,"h6",52),a(1),i(),d(2,K,2,1,"small",12)),n&2){let e=p().$implicit;o(),l(e.book.title),o(),s(e.book.author!=null&&e.book.author.name?2:-1)}}function X(n,r){n&1&&(t(0,"h6",48),a(1,"Book unavailable"),i())}function Y(n,r){if(n&1&&(t(0,"div",26),d(1,Q,1,2,"img",45)(2,J,3,0,"div",46),t(3,"div",47),d(4,W,3,2)(5,X,2,0,"h6",48),t(6,"small",49),a(7),u(8,"currency"),i()(),t(9,"div",11),a(10),u(11,"currency"),i()()),n&2){let e=r.$implicit;o(),s(e.book!=null&&e.book.coverUrl?1:2),o(3),s(e.book?4:5),o(3),O("Qty: ",e.quantity," \xB7 ",x(8,5,e.unit_price)),o(3),l(x(11,7,e.unit_price*e.quantity))}}function Z(n,r){if(n&1&&(t(0,"div",28)(1,"span"),a(2,"Tax"),i(),t(3,"span"),a(4),u(5,"currency"),i()()),n&2){let e=p(2);o(4),l(x(5,1,e.order.total_price-e.subtotal))}}function ee(n,r){if(n&1&&(t(0,"div",14)(1,"div")(2,"h4",15),a(3),i(),t(4,"span",12),a(5),u(6,"date"),i()(),t(7,"div",16)(8,"span"),a(9),u(10,"titlecase"),i()()(),t(11,"div",17)(12,"div",18),_(13,H,6,6,"div",19,z),i()(),t(15,"div",20)(16,"div",21)(17,"div",22)(18,"div",23)(19,"h6",24),a(20),i()(),d(21,N,2,0,"div",25),_(22,Y,12,9,"div",26,k().trackByItemId,!0),i()(),t(24,"div")(25,"div",17)(26,"h6",27),a(27,"Order Summary"),i(),t(28,"div",28)(29,"span"),a(30,"Subtotal"),i(),t(31,"span"),a(32),u(33,"currency"),i()(),t(34,"div",28)(35,"span"),a(36,"Shipping"),i(),t(37,"span",29),a(38,"Free"),i()(),d(39,Z,6,3,"div",28),t(40,"div",30)(41,"span",11),a(42,"Total"),i(),t(43,"span",31),a(44),u(45,"currency"),i()()(),t(46,"div",32)(47,"h6",33),g(),t(48,"svg",34),m(49,"path",35)(50,"path",36),i(),a(51," Shipping "),i(),h(),t(52,"div",12)(53,"p",37),a(54),i(),t(55,"p",37),a(56),i(),t(57,"p",38),a(58),i(),t(59,"div",39)(60,"span"),a(61,"Payment"),i(),t(62,"span",40),a(63),i()()()()()()),n&2){let e=p();o(3),b("Order #",e.order._id.slice(-8).toUpperCase()),o(2),l(D(6,17,e.order.createdAt,"MMMM d, y \u2014 h:mm a")),o(3),f(M("inline-block px-3 py-1 rounded-full text-sm font-semibold badge-status-",e.order.status)),o(),l(x(10,20,e.order.status)),o(4),C(e.timelineSteps),o(7),b("Items (",e.totalQuantity,")"),o(),s(e.order.items.length===0?21:-1),o(),C(e.order.items),o(10),l(x(33,22,e.subtotal)),o(7),s(e.order.total_price!==e.subtotal?39:-1),o(5),l(x(45,24,e.order.total_price)),o(10),l(e.order.shipping_address.street),o(2),I("",e.order.shipping_address.city,", ",e.order.shipping_address.state," ",e.order.shipping_address.zip),o(2),l(e.order.shipping_address.country),o(5),l(e.order.payment_method)}}var $=class n{constructor(r,e,c){this.route=r;this.router=e;this.orderService=c}order=null;loading=!0;error="";showCancelModal=!1;cancelLoading=!1;cancelError="";ngOnInit(){let r=this.route.snapshot.paramMap.get("id");if(!r){this.error="Invalid order ID",this.loading=!1;return}this.loadOrder(r)}loadOrder(r){this.loading=!0,this.error="",this.orderService.getOrderById(r).subscribe({next:e=>{this.order=e.order,this.loading=!1,console.log("Order detail:",this.order)},error:e=>{this.loading=!1,this.error=e?.error?.error||e?.message||"Failed to load order"}})}get canCancel(){return this.order?.status==="pending"}openCancelModal(){this.showCancelModal=!0,this.cancelError=""}closeCancelModal(){this.showCancelModal=!1}confirmCancel(){this.order&&(this.cancelLoading=!0,this.cancelError="",this.orderService.cancelOrder(this.order._id).subscribe({next:r=>{this.cancelLoading=!1,this.showCancelModal=!1,this.order=r.order},error:r=>{this.cancelLoading=!1,this.cancelError=r?.error?.error||r?.message||"Failed to cancel"}}))}getStatusConfig(r){return{pending:{color:"text-yellow-800",bgColor:"bg-yellow-100 border-yellow-200",icon:"\u{1F550}"},processing:{color:"text-blue-800",bgColor:"bg-blue-100 border-blue-200",icon:"\u2699\uFE0F"},shipped:{color:"text-purple-800",bgColor:"bg-purple-100 border-purple-200",icon:"\u{1F69A}"},delivered:{color:"text-green-800",bgColor:"bg-green-100 border-green-200",icon:"\u2705"},cancelled:{color:"text-red-800",bgColor:"bg-red-100 border-red-200",icon:"\u274C"}}[r]||{color:"text-gray-800",bgColor:"bg-gray-100",icon:"\u{1F4E6}"}}get timelineSteps(){if(!this.order)return[];let r=["pending","processing","shipped","delivered"];if(this.order.status==="cancelled")return[{label:"Placed",done:!0,active:!1},{label:"Cancelled",done:!0,active:!0}];let e=r.indexOf(this.order.status);return r.map((c,w)=>({label:c.charAt(0).toUpperCase()+c.slice(1),done:w<=e,active:w===e}))}get subtotal(){return this.order?this.order.items.reduce((r,e)=>r+e.unit_price*e.quantity,0):0}get totalQuantity(){return this.order?this.order.items.reduce((r,e)=>r+e.quantity,0):0}trackByItemId(r,e){return e._id}static \u0275fac=function(e){return new(e||n)(v(L),v(A),v(R))};static \u0275cmp=y({type:n,selectors:[["app-order-detail"]],decls:8,vars:3,consts:[[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],["routerLink","/orders",1,"text-sm","text-gray-600","inline-flex","items-center","gap-1","mb-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-3.5","h-3.5"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"],[1,"space-y-3"],[1,"bg-white","rounded-lg","shadow-sm","text-center","py-8"],[1,"h-8","bg-gray-200","rounded","w-1/3"],[1,"h-20","bg-gray-200","rounded","w-full"],[1,"h-48","bg-gray-200","rounded","w-full"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-8","h-8","text-red-600","mx-auto","mb-3"],["stroke-linecap","round","stroke-linejoin","round","d","M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"],[1,"font-semibold"],[1,"text-sm","text-gray-500"],["routerLink","/orders",1,"inline-block","mt-3","px-3","py-1","bg-green-600","text-white","text-sm","rounded"],[1,"flex","flex-col","md:flex-row","justify-between","md:items-center","gap-3","mb-4"],[1,"font-bold","mb-1"],[1,"flex","items-center","gap-2"],[1,"bg-white","rounded-lg","shadow-sm","mb-4","p-4"],[1,"flex","justify-between","items-center"],[1,"text-center",2,"z-index","1"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4"],[1,"lg:col-span-2"],[1,"bg-white","rounded-lg","shadow-sm","overflow-hidden"],[1,"px-4","py-3","border-b"],[1,"font-semibold","mb-0"],[1,"p-6","text-center","text-gray-500"],[1,"flex","items-center","gap-3","px-4","py-4","border-b"],[1,"font-semibold","mb-3"],[1,"flex","justify-between","text-sm","text-gray-500","mb-2"],[1,"text-green-600","font-medium"],[1,"border-t","mt-3","pt-3","flex","justify-between"],[1,"font-semibold","text-lg"],[1,"bg-white","rounded-lg","shadow-sm","p-4"],[1,"font-semibold","mb-2","inline-flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"],[1,"mb-1"],[1,"mb-3"],[1,"border-t","pt-3","flex","justify-between","items-center"],[1,"uppercase","font-medium"],[1,"mx-auto","mb-2","flex","items-center","justify-center","rounded-full",2,"width","40px","height","40px"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],[1,"font-semibold","text-sm"],["stroke-linecap","round","stroke-linejoin","round","d","M4.5 12.75l6 6 9-13.5"],[1,"rounded",2,"width","60px","height","75px","object-fit","cover",3,"src","alt"],[1,"bg-gray-100","rounded","flex","items-center","justify-center",2,"width","60px","height","75px"],[1,"flex-1"],[1,"mb-0","text-gray-500","italic"],[1,"text-sm","text-gray-500","block","mt-1"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","d","M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"],[1,"mb-0","font-semibold"]],template:function(e,c){e&1&&(t(0,"div",0)(1,"a",1),g(),t(2,"svg",2),m(3,"path",3),i(),a(4," Back to Orders "),i(),d(5,G,4,0,"div",4),d(6,U,9,1,"div",5),d(7,ee,64,26),i()),e&2&&(o(5),s(c.loading?5:-1),o(),s(c.error&&!c.loading?6:-1),o(),s(c.order&&!c.loading?7:-1))},dependencies:[F,P,T,j,B],encapsulation:2})};export{$ as OrderDetailComponent};
