import{a as R}from"./chunk-CSFBZRFP.js";import"./chunk-HOACR73J.js";import{$ as t,Aa as h,Ba as S,H as D,Ha as F,I as o,Ia as L,Ja as $,L as y,M as T,Pa as z,Ra as A,Sa as P,T as j,U as s,V as m,Y as k,Z as E,_ as O,aa as i,ba as u,fa as I,ha as v,ja as d,la as C,ma as a,na as x,oa as p,pa as M,qa as B,va as V,w as _,x as b,y as f,z as w,za as g}from"./chunk-VPDMBE7M.js";var U=(n,r)=>r.label;function q(n,r){n&1&&(t(0,"div",4),u(1,"div",7)(2,"div",8)(3,"div",9),i())}function H(n,r){if(n&1&&(t(0,"div",5)(1,"h3",10),a(2,"Order not found"),i(),t(3,"p",11),a(4),i(),t(5,"a",12),a(6," Back to Orders "),i()()),n&2){let e=d();o(4),x(e.error)}}function N(n,r){if(n&1){let e=I();t(0,"button",46),v("click",function(){_(e);let c=d(2);return b(c.openCancelModal())}),a(1," Cancel Order "),i()}}function Q(n,r){n&1&&(f(),t(0,"svg",48),u(1,"path",52),i())}function K(n,r){if(n&1&&(t(0,"span",49),a(1),i()),n&2){let e=d().$index;o(),x(e+1)}}function Y(n,r){if(n&1&&u(0,"div",53),n&2){let e=d().$implicit;C(e.done?"bg-green-500":"bg-gray-200")}}function J(n,r){if(n&1&&(t(0,"div",47)(1,"div"),s(2,Q,2,0,":svg:svg",48)(3,K,2,1,"span",49),i(),t(4,"span",50),a(5),i()(),s(6,Y,1,2,"div",51)),n&2){let e=r.$implicit,l=r.$index,c=r.$count;o(),C(e.done?e.active?"w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center ring-4 ring-blue-100":"w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center":"w-10 h-10 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center"),o(),m(e.done&&!e.active?2:3),o(2),C(e.done?"text-gray-900":"text-gray-400"),o(),p(" ",e.label," "),o(),m(l!==c-1?6:-1)}}function W(n,r){n&1&&(t(0,"div",24)(1,"p"),a(2,"No items in this order"),i()())}function X(n,r){if(n&1&&u(0,"img",54),n&2){let e=d().$implicit;O("src",e.book==null?null:e.book.coverUrl,D)("alt",(e.book==null?null:e.book.title)||"Book")}}function Z(n,r){n&1&&(t(0,"div",55),f(),t(1,"svg",59),u(2,"path",60),i()())}function ee(n,r){if(n&1&&(t(0,"p",62),a(1),i()),n&2){let e=d(2).$implicit;o(),p("by ",e.book.author==null?null:e.book.author.name)}}function te(n,r){if(n&1&&(t(0,"h3",61),a(1),i(),s(2,ee,2,1,"p",62)),n&2){let e=d().$implicit;o(),x(e.book.title),o(),m(e.book.author!=null&&e.book.author.name?2:-1)}}function ie(n,r){n&1&&(t(0,"h3",57),a(1,"Book no longer available"),i())}function ne(n,r){if(n&1&&(t(0,"div",25),s(1,X,1,2,"img",54)(2,Z,3,0,"div",55),t(3,"div",56),s(4,te,3,2)(5,ie,2,0,"h3",57),t(6,"p",15),a(7),g(8,"currency"),i()(),t(9,"div",58)(10,"p",23),a(11),g(12,"currency"),i()()()),n&2){let e=r.$implicit;o(),m(e.book!=null&&e.book.coverUrl?1:2),o(3),m(e.book?4:5),o(3),M(" ",h(8,5,e.unit_price)," \xD7 ",e.quantity," "),o(4),p(" ",h(12,7,e.unit_price*e.quantity)," ")}}function re(n,r){if(n&1&&(t(0,"div",40)(1,"span"),a(2,"Tax / Fees"),i(),t(3,"span"),a(4),g(5,"currency"),i()()),n&2){let e=d(2);o(4),x(h(5,1,e.order.total_price-e.subtotal))}}function oe(n,r){if(n&1&&(t(0,"div",13)(1,"div")(2,"h1",14),a(3),i(),t(4,"p",15),a(5),g(6,"date"),i()(),t(7,"div",16)(8,"span"),a(9),i(),s(10,N,2,0,"button",17),i()(),t(11,"div",18)(12,"h2",19),a(13," Order Progress "),i(),t(14,"div",20),k(15,J,7,7,null,null,U),i()(),t(17,"div",21)(18,"div",22)(19,"h2",23),a(20),i()(),s(21,W,3,0,"div",24),k(22,ne,13,9,"div",25,j().trackByItemId,!0),i(),t(24,"div",26)(25,"div",27)(26,"h2",28),f(),t(27,"svg",29),u(28,"path",30)(29,"path",31),i(),a(30," Shipping Address "),i(),w(),t(31,"div",32)(32,"p"),a(33),i(),t(34,"p"),a(35),i(),t(36,"p"),a(37),i()(),t(38,"div",33)(39,"h3",34),a(40,"Payment"),i(),t(41,"div",35)(42,"span",36),a(43),i(),t(44,"span"),a(45,"\xB7"),i(),t(46,"span",37),a(47),i()()()(),t(48,"div",27)(49,"h2",38),a(50,"Order Summary"),i(),t(51,"div",39)(52,"div",40)(53,"span"),a(54),i(),t(55,"span"),a(56),g(57,"currency"),i()(),t(58,"div",40)(59,"span"),a(60,"Shipping"),i(),t(61,"span",41),a(62,"Free"),i()(),s(63,re,6,3,"div",40),t(64,"div",42)(65,"span",43),a(66,"Total"),i(),t(67,"span",43),a(68),g(69,"currency"),i()()(),t(70,"div",44)(71,"div",45)(72,"span"),a(73,"Order placed"),i(),t(74,"span"),a(75),g(76,"date"),i()(),t(77,"div",45)(78,"span"),a(79,"Last updated"),i(),t(80,"span"),a(81),g(82,"date"),i()()()()()),n&2){let e=d();o(3),p(" Order #",e.order._id.slice(-8).toUpperCase()," "),o(2),p(" Placed on ",S(6,26,e.order.createdAt,"MMMM d, y \u2014 h:mm a")," "),o(3),C(V(`px-4 py-1.5 rounded-full text-sm font-semibold capitalize border
                     `,e.getStatusConfig(e.order.status).bgColor,`
                     `,e.getStatusConfig(e.order.status).color)),o(),M(" ",e.getStatusConfig(e.order.status).icon," ",e.order.status," "),o(),m(e.canCancel?10:-1),o(5),E(e.timelineSteps),o(5),p("Items (",e.totalQuantity,")"),o(),m(e.order.items.length===0?21:-1),o(),E(e.order.items),o(11),x(e.order.shipping_address.street),o(2),B(" ",e.order.shipping_address.city,", ",e.order.shipping_address.state," ",e.order.shipping_address.zip," "),o(2),x(e.order.shipping_address.country),o(6),x(e.order.payment_method),o(3),C(e.order.payment_status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),o(),p(" ",e.order.payment_status," "),o(7),p("Subtotal (",e.totalQuantity," items)"),o(2),x(h(57,29,e.subtotal)),o(7),m(e.order.total_price!==e.subtotal?63:-1),o(5),p(" ",h(69,31,e.order.total_price)," "),o(7),x(S(76,33,e.order.createdAt,"MMM d, y")),o(6),x(S(82,36,e.order.updatedAt,"MMM d, y"))}}function ae(n,r){if(n&1&&(t(0,"div",70),a(1),i()),n&2){let e=d(2);o(),p(" ",e.cancelError," ")}}function le(n,r){if(n&1){let e=I();t(0,"div",63),v("click",function(){_(e);let c=d();return b(c.closeCancelModal())}),t(1,"div",64),v("click",function(c){return _(e),b(c.stopPropagation())}),t(2,"div",65),f(),t(3,"svg",66),u(4,"path",67),i()(),w(),t(5,"h3",68),a(6,"Cancel Order?"),i(),t(7,"p",69),a(8,"This action cannot be undone."),i(),s(9,ae,2,1,"div",70),t(10,"div",71)(11,"button",72),v("click",function(){_(e);let c=d();return b(c.closeCancelModal())}),a(12," Keep Order "),i(),t(13,"button",73),v("click",function(){_(e);let c=d();return b(c.confirmCancel())}),a(14),i()()()()}if(n&2){let e=d();o(9),m(e.cancelError?9:-1),o(4),O("disabled",e.cancelLoading),o(),p(" ",e.cancelLoading?"Cancelling\u2026":"Yes, Cancel"," ")}}var G=class n{constructor(r,e,l){this.route=r;this.router=e;this.orderService=l}order=null;loading=!0;error="";showCancelModal=!1;cancelLoading=!1;cancelError="";ngOnInit(){let r=this.route.snapshot.paramMap.get("id");if(!r){this.error="Invalid order ID",this.loading=!1;return}this.loadOrder(r)}loadOrder(r){this.loading=!0,this.error="",this.orderService.getOrderById(r).subscribe({next:e=>{this.order=e.order,this.loading=!1,console.log("Order detail:",this.order)},error:e=>{this.loading=!1,this.error=e?.error?.error||e?.message||"Failed to load order"}})}get canCancel(){return this.order?.status==="pending"}openCancelModal(){this.showCancelModal=!0,this.cancelError=""}closeCancelModal(){this.showCancelModal=!1}confirmCancel(){this.order&&(this.cancelLoading=!0,this.cancelError="",this.orderService.cancelOrder(this.order._id).subscribe({next:r=>{this.cancelLoading=!1,this.showCancelModal=!1,this.order=r.order},error:r=>{this.cancelLoading=!1,this.cancelError=r?.error?.error||r?.message||"Failed to cancel"}}))}getStatusConfig(r){return{pending:{color:"text-yellow-800",bgColor:"bg-yellow-100 border-yellow-200",icon:"\u{1F550}"},processing:{color:"text-blue-800",bgColor:"bg-blue-100 border-blue-200",icon:"\u2699\uFE0F"},shipped:{color:"text-purple-800",bgColor:"bg-purple-100 border-purple-200",icon:"\u{1F69A}"},delivered:{color:"text-green-800",bgColor:"bg-green-100 border-green-200",icon:"\u2705"},cancelled:{color:"text-red-800",bgColor:"bg-red-100 border-red-200",icon:"\u274C"}}[r]||{color:"text-gray-800",bgColor:"bg-gray-100",icon:"\u{1F4E6}"}}get timelineSteps(){if(!this.order)return[];let r=["pending","processing","shipped","delivered"];if(this.order.status==="cancelled")return[{label:"Placed",done:!0,active:!1},{label:"Cancelled",done:!0,active:!0}];let e=r.indexOf(this.order.status);return r.map((l,c)=>({label:l.charAt(0).toUpperCase()+l.slice(1),done:c<=e,active:c===e}))}get subtotal(){return this.order?this.order.items.reduce((r,e)=>r+e.unit_price*e.quantity,0):0}get totalQuantity(){return this.order?this.order.items.reduce((r,e)=>r+e.quantity,0):0}trackByItemId(r,e){return e._id}static \u0275fac=function(e){return new(e||n)(y(z),y(A),y(R))};static \u0275cmp=T({type:n,selectors:[["app-order-detail"]],decls:9,vars:4,consts:[[1,"max-w-4xl","mx-auto","px-4","py-8"],["routerLink","/orders",1,"inline-flex","items-center","gap-1","text-sm","text-blue-600","hover:underline","mb-6"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","d","M15.75 19.5L8.25 12l7.5-7.5"],[1,"space-y-6","animate-pulse"],[1,"bg-white","border","border-gray-200","rounded-xl","p-8","text-center"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center","p-4"],[1,"h-7","bg-gray-200","rounded","w-64"],[1,"h-16","bg-gray-200","rounded-xl"],[1,"h-48","bg-gray-200","rounded-xl"],[1,"text-lg","font-semibold","text-gray-900","mb-1"],[1,"text-sm","text-gray-500","mb-4"],["routerLink","/orders",1,"inline-block","px-4","py-2","bg-blue-600","text-white","text-sm","font-medium","rounded-lg","hover:bg-blue-700","transition"],[1,"flex","flex-col","sm:flex-row","sm:items-start","justify-between","gap-4","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"flex","items-center","gap-3"],[1,"px-4","py-1.5","text-sm","font-medium","text-red-600","border","border-red-200","rounded-lg","hover:bg-red-50","transition"],[1,"bg-white","border","border-gray-200","rounded-xl","p-6","mb-6"],[1,"text-sm","font-semibold","text-gray-500","uppercase","tracking-wider","mb-4"],[1,"flex","items-center","justify-between"],[1,"bg-white","border","border-gray-200","rounded-xl","overflow-hidden","mb-6"],[1,"px-6","py-4","bg-gray-50","border-b"],[1,"font-semibold","text-gray-900"],[1,"px-6","py-8","text-center","text-gray-400"],[1,"flex","items-center","gap-4","px-6","py-4","border-b","last:border-b-0"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"bg-white","border","border-gray-200","rounded-xl","p-6"],[1,"font-semibold","text-gray-900","mb-4","flex","items-center","gap-2"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24",1,"h-5","w-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","d","M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"],[1,"text-sm","text-gray-600","space-y-1"],[1,"mt-6","pt-4","border-t","border-gray-100"],[1,"text-sm","font-semibold","text-gray-900","mb-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-600"],[1,"capitalize"],[1,"px-2","py-0.5","rounded-full","text-xs"],[1,"font-semibold","text-gray-900","mb-4"],[1,"space-y-3","text-sm"],[1,"flex","justify-between","text-gray-600"],[1,"text-green-600","font-medium"],[1,"border-t","border-gray-200","pt-3","flex","justify-between"],[1,"text-base","font-bold","text-gray-900"],[1,"mt-6","pt-4","border-t","border-gray-100","space-y-2","text-xs","text-gray-400"],[1,"flex","justify-between"],[1,"px-4","py-1.5","text-sm","font-medium","text-red-600","border","border-red-200","rounded-lg","hover:bg-red-50","transition",3,"click"],[1,"flex","flex-col","items-center","gap-2","z-10"],["fill","none","stroke","currentColor","stroke-width","3","viewBox","0 0 24 24",1,"h-5","w-5"],[1,"text-sm","font-bold"],[1,"text-xs","font-medium"],[1,"flex-1","h-1","mx-2","rounded-full","-mt-6",3,"class"],["stroke-linecap","round","stroke-linejoin","round","d","M4.5 12.75l6 6 9-13.5"],[1,"flex-1","h-1","mx-2","rounded-full","-mt-6"],[1,"w-16","h-20","object-cover","rounded-lg","shadow-sm","shrink-0",3,"src","alt"],[1,"w-16","h-20","bg-gray-100","rounded-lg","flex","items-center","justify-center","shrink-0"],[1,"flex-1","min-w-0"],[1,"font-medium","text-gray-400","italic"],[1,"text-right","shrink-0"],["fill","none","stroke","currentColor","stroke-width","1.5","viewBox","0 0 24 24",1,"h-8","w-8","text-gray-300"],["stroke-linecap","round","stroke-linejoin","round","d",`M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25
                     A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966
                     8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018
                     18a8.967 8.967 0 00-6 2.292m0-14.25v14.25`],[1,"font-medium","text-gray-900","truncate"],[1,"text-sm","text-gray-500"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-white","rounded-2xl","shadow-xl","w-full","max-w-sm","p-6",3,"click"],[1,"mx-auto","mb-4","flex","h-14","w-14","items-center","justify-center","rounded-full","bg-red-100"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24",1,"h-7","w-7","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","d",`M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73
                 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898
                 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z`],[1,"text-lg","font-bold","text-gray-900","text-center","mb-2"],[1,"text-sm","text-gray-500","text-center","mb-6"],[1,"mb-4","rounded-lg","bg-red-50","border","border-red-200","text-red-700","px-3","py-2","text-sm"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2.5","text-sm","font-medium","text-gray-700","bg-gray-100","rounded-lg","hover:bg-gray-200","transition",3,"click"],[1,"flex-1","px-4","py-2.5","text-sm","font-medium","text-white","bg-red-600","rounded-lg","hover:bg-red-700","disabled:bg-red-400","transition",3,"click","disabled"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"a",1),f(),t(2,"svg",2),u(3,"path",3),i(),a(4," Back to Orders "),i(),s(5,q,4,0,"div",4),s(6,H,7,1,"div",5),s(7,oe,83,39),s(8,le,15,3,"div",6),i()),e&2&&(o(5),m(l.loading?5:-1),o(),m(l.error&&!l.loading?6:-1),o(),m(l.order&&!l.loading?7:-1),o(),m(l.showCancelModal?8:-1))},dependencies:[$,P,L,F],encapsulation:2})};export{G as OrderDetailComponent};
