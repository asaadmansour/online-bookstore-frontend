<!-- src/app/features/order-history/order-list/order-list.html -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between md:items-center gap-3 mb-4">
    <div>
      <h4 class="font-bold mb-1">My Orders</h4>
      @if (!loading && totalItems > 0) {
      <p class="text-sm text-gray-500 mb-0">{{ totalItems }} order{{ totalItems !== 1 ? 's' : '' }}</p>
      }
    </div>
    <select class="border border-gray-200 rounded px-2 py-1 text-sm" style="width: auto" [(ngModel)]="selectedStatus"
      (ngModelChange)="onStatusChange()">
      @for (s of statuses; track s.value) {
      <option [value]="s.value">{{ s.label }}</option>
      }
    </select>
  </div>

  <!-- Loading -->
  @if (loading) {
  <div class="bg-white rounded-lg shadow-sm">
    <div class="p-4">
      @for (i of [1, 2, 3]; track i) {
      <div class="flex gap-3 py-3 border-b animate-pulse">
        <div class="h-4 bg-gray-200 rounded w-1/6"></div>
        <div class="h-4 bg-gray-200 rounded w-1/4"></div>
        <div class="h-4 bg-gray-200 rounded w-1/12"></div>
        <div class="h-4 bg-gray-200 rounded w-1/6"></div>
      </div>
      }
    </div>
  </div>
  }

  <!-- Error -->
  @if (error && !loading) {
  <div class="bg-white rounded-lg shadow-sm text-center py-8">
    <div class="px-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-600 mx-auto mb-3" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
      </svg>
      <h6 class="font-semibold">Something went wrong</h6>
      <p class="text-sm text-gray-500 mb-3">{{ error }}</p>
      <button class="px-3 py-1 bg-green-600 text-white text-sm rounded" (click)="loadOrders()">Try Again</button>
    </div>
  </div>
  }

  <!-- Empty -->
  @if (!loading && !error && orders.length === 0) {
  <div class="bg-white rounded-lg shadow-sm text-center py-8">
    <div class="px-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400 mx-auto mb-3" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
      </svg>
      <h6 class="font-semibold">No orders yet</h6>
      <p class="text-sm text-gray-500 mb-3">Start browsing and place your first order!</p>
      <a routerLink="/books" class="inline-block px-3 py-1 bg-green-600 text-white text-sm rounded">Browse Books</a>
    </div>
  </div>
  }

  <!-- Orders table -->
  @if (!loading && !error && orders.length > 0) {
  <div class="bg-white rounded-lg shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm table-auto">
        <thead class="bg-gray-50">
          <tr class="text-left text-xs text-gray-600">
            <th class="px-4 py-3">ORDER</th>
            <th class="px-4 py-3">DATE</th>
            <th class="px-4 py-3">ITEMS</th>
            <th class="px-4 py-3">TOTAL</th>
            <th class="px-4 py-3">STATUS</th>
            <th class="px-4 py-3">PAYMENT</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders; track trackByOrderId($index, order)) {
          <tr class="hover:bg-gray-50 cursor-pointer" [routerLink]="['/orders', order._id]">
            <td class="px-4 py-3">
              <span class="font-semibold">#{{ order._id.slice(-8).toUpperCase() }}</span>
            </td>
            <td class="px-4 py-3"><span class="text-sm text-gray-500">{{ order.createdAt | date: 'MMM d, y' }}</span>
            </td>
            <td class="px-4 py-3"><span class="text-sm text-gray-500">{{ getItemsSummary(order) }}</span></td>
            <td class="px-4 py-3"><span class="font-semibold">{{ order.total_price | currency }}</span></td>
            <td class="px-4 py-3">
              <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold badge-status-{{ order.status }}">{{
                order.status | titlecase }}</span>
            </td>
            <td class="px-4 py-3"><span class="text-sm text-gray-500 uppercase">{{ order.payment_method }}</span></td>
            <td class="px-4 py-3 text-gray-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
              </svg>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
    <div class="px-4 py-3 flex items-center justify-between">
      <small class="text-sm text-gray-500"> Page {{ currentPage }} of {{ totalPages }} </small>
      <nav>
        <ul class="inline-flex items-center space-x-2">
          <li>
            <button class="px-2 py-1 rounded border border-gray-200 text-sm" [disabled]="currentPage === 1"
              (click)="goToPage(currentPage - 1)">Previous</button>
          </li>
          @for (p of pageNumbers; track $index) {
          @if (p === '...') {
          <li><span class="px-2 text-sm text-gray-500">â€¦</span></li>
          } @else {
          <li>
            <button class="px-3 py-1 rounded text-sm" [class.bg-gray-900]="p === currentPage"
              [class.text-white]="p === currentPage" (click)="goToPage(+p)">{{ p }}</button>
          </li>
          }
          }
          <li>
            <button class="px-2 py-1 rounded border border-gray-200 text-sm" [disabled]="currentPage === totalPages"
              (click)="goToPage(currentPage + 1)">Next</button>
          </li>
        </ul>
      </nav>
    </div>
    }
  </div>
  }
</div>