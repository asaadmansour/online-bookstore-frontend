<form [formGroup]="newBook" (ngSubmit)="submit(newBook)">
  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <button type="button" routerLink="/admin/manage-books"
      class="w-8 h-8 rounded-lg border border-border-light text-text-muted hover:border-accent hover:text-accent transition-colors flex items-center justify-center text-sm">
      ‚Üê
    </button>
    <div>
      <h2 class="text-2xl font-bold text-text-main">Add New Book</h2>
      <p class="text-text-muted text-sm mt-0.5">Fill in the details to add a new book to the store</p>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-8">

    <!-- Left: Main Form -->
    <div class="col-span-2 flex flex-col gap-6">

      <div class="bg-white rounded-2xl shadow-soft p-6">
        <h3 class="text-base font-semibold text-text-main mb-5">Basic Information</h3>
        <div class="flex flex-col gap-4">

          <div>
            <label for="name" class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Book
              Title</label>
            <input id="name" type="text" formControlName="name" required minlength="3" maxlength="50"
              placeholder="Enter book title"
              class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors" />
            @if (newBook.get('name')?.touched) {
            @if (newBook.get('name')?.getError('required')) {
            <p class="text-red-600">This input is required</p>
            }
            }
          </div>

          <div>
            <label for="description"
              class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Description</label>
            <textarea id="description" formControlName="description" rows="4"
              placeholder="Enter book description (30‚Äì500 characters)"
              class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors"></textarea>
            @if(newBook.get('description')?.touched){
            @if (newBook.get('description')?.getError('required')) {
            <p class="text-red-600">This input is required</p>
            }
            }
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="author"
                class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Author</label>
              <select formControlName="author" id="author"
                class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors">
                <option value="">Select author...</option>
                @for(author of authors(); track author._id) {
                <option [value]="author._id">{{author.name}}</option>
                }
              </select>
              @if(newBook.get('author')?.touched){
              @if(newBook.get('author')?.getError('required')){
              <p class="text-red-600 text-xs mt-1">This input is required</p>
              }
              }
            </div>
            <div>
              <label for="price" class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Price
                ($)</label>
              <input id="price" formControlName="price" type="number" placeholder="0.00" min="0" step="0.01"
                class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors" />
              @if(newBook.get('price')?.touched){
              @if(newBook.get('price')?.getError('required')){
              <p class="text-red-600 text-xs mt-1">This input is required</p>
              }
              }
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="categories"
                class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Categories</label>
              <select formControlName="categories" id="categories" multiple
                class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors h-32">
                @for(cat of categories(); track cat._id) {
                <option [value]="cat._id">{{cat.name}}</option>
                }
              </select>
              @if(newBook.get('categories')?.value?.length > 0) {
              <div class="flex flex-wrap gap-1 mt-2">
                @for(name of getSelectedCategoryNames().split(', '); track $index) {
                <span class="bg-accent-light text-accent px-2 py-0.5 rounded-full text-xs">{{name}}</span>
                }
              </div>
              }
              <p class="text-text-muted text-xs mt-1">Hold Ctrl to select multiple</p>
            </div>
            <div>
              <label for="stock"
                class="text-xs font-medium text-text-muted uppercase tracking-widest mb-1 block">Stock</label>
              <input id="stock" type="number" formControlName="stock" placeholder="0" min="0"
                class="w-full px-4 py-3 rounded-xl border border-border-light bg-white text-text-main text-sm outline-none focus:border-accent transition-colors" />
              @if(newBook.get('stock')?.touched){
              @if(newBook.get('stock')?.getError('required')){
              <p class="text-red-600 text-xs mt-1">This input is required</p>
              }
              }
            </div>

          </div>

        </div>
      </div>

      <div class="flex gap-3 justify-end">
        <button type="button" routerLink="/admin/manage-books"
          class="px-6 py-3 rounded-xl border border-border-light text-text-muted text-sm hover:border-accent hover:text-accent transition-colors">
          Cancel
        </button>
        <button type="submit"
          class="px-6 py-3 rounded-xl bg-accent hover:bg-accent-hover text-white text-sm font-semibold transition-colors">
          Add Book
        </button>
      </div>

    </div>

    <!-- Right: Cover Upload -->
    <div class="col-span-1">
      <div class="bg-white rounded-2xl shadow-soft p-6 sticky top-8">
        <h3 class="text-base font-semibold text-text-main mb-5">Book Cover</h3>

        @if(previewUrl()) {
        <!-- Image Preview -->
        <div class="mb-4 rounded-2xl overflow-hidden border-2 border-accent bg-accent-light">
          <img [src]="previewUrl()" alt="Cover preview" class="w-full h-auto object-cover" />
        </div>
        <div class="p-3 bg-success-light border border-success rounded-xl mb-4">
          <p class="text-xs font-medium text-green-600">‚úì Cover image uploaded successfully</p>
        </div>
        <button type="button" (click)="clearCover()"
          class="w-full px-4 py-2 text-xs text-accent border border-accent rounded-xl hover:bg-accent-light transition-colors">
          Change Cover
        </button>
        } @else {
        <div
          class="border-2 border-dashed border-border-light rounded-2xl p-6 flex flex-col items-center justify-center gap-3 hover:border-accent transition-colors cursor-pointer min-h-64">
          <span class="text-4xl">üìö</span>
          <p class="text-text-muted text-sm text-center">Drag & drop your cover image here</p>
          <p class="text-text-muted text-xs">PNG, JPG up to 5MB</p>
          <label for="cover"
            class="px-4 py-2 rounded-xl border border-accent text-accent text-xs font-medium hover:bg-accent hover:text-white transition-colors cursor-pointer">
            Browse File
            <input id="cover" (change)="selectFile($event)" type="file" accept="image/*" class="hidden" />
          </label>
        </div>
        <p class="text-text-muted text-xs text-center mt-3">Preview will appear here after upload</p>
        }
      </div>
    </div>

  </div>
</form>